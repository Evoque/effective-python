

文件描述符的共享是进程间通信(IPC)和资源复用的核心机制，其原理与操作系统的`进程控制块(PCB)`、`文件表(File Table)`和`inode表`密切相关。

## 一、文件描述符的底层数据结构
### 1. 进程控制块（PCB）
每个进程都有一个PCB（在Linux中对应`task_struct`结构体），其中包含一个`文件描述符（File Descriptor Table）`，本质是一个数组，下标为文件描述符，数组元素指向系统全局的`文件表项（File Table Entry）`。

### 2. 文件表（File Table）
系统维护全局的文件表，每个表项纪录一个打开的动态状态，包括：
- 文件偏移量（下次读写的位置）；
- 访问模式（只读、只写、读写等）；
- 引用计数（多少个文件描述符指向该表项）；
- 指向inode表的指针。

### 3. inode表（inode Table）
存储文件的元数据（如文件类型、权限、大小、磁盘块位置等），是文件的静态属性描述，每个文件对应一个inode。

三者的关系可简化为：
```
进程PCB -> 文件描述符表（FD）-> 文件表项 -> inode表 -> 实际文件/资源
```